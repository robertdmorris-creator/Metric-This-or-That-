<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>This or That: All-in-One Drag & Drop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700&family=Lilita+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-image: linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%);
            color: #4a5568;
        }
        .font-lilita {
            font-family: 'Lilita One', cursive;
        }
        .card {
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            border: 4px solid white;
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .choice-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            min-height: 280px;
            padding: 1.5rem;
        }
        .choice-card.correct { border-color: #34d399; background-color: rgba(167, 243, 208, 0.9); }
        .choice-card.incorrect { border-color: #fb7185; background-color: rgba(254, 205, 211, 0.9); }
        .choice-card.drop-zone-active { border-color: #facc15; transform: scale(1.02); }
        .team-token-disc {
            width: 60px;
            height: 60px;
            border-radius: 9999px;
            cursor: grab;
            transition: all 0.2s ease;
            border: 4px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .team-token-disc:active { cursor: grabbing; transform: scale(1.1); z-index: 50; }
        .team-token-disc.placed {
            width: 32px;
            height: 32px;
            border-width: 2px;
        }
        .token-start-zone {
            min-height: 70px;
            width: 100%;
            border: 2px dashed #94a3b8;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255,255,255,0.2);
        }
        .btn {
            border-radius: 0.75rem;
            font-weight: 700;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 2px solid transparent;
        }
        .btn-primary { background-color: #ec4899; color: white; }
        .btn-primary:hover { background-color: #d946ef; }
        .btn-green { background-color: #22c55e; color: white; }
        .btn-green:hover { background-color: #16a34a; }
        .btn-yellow { background-color: #f59e0b; color: white; }
        .btn-yellow:hover { background-color: #d97706; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-5xl mx-auto text-center relative">
        <button id="fullscreen-btn" class="absolute top-2 right-2 z-50 p-2 rounded-full bg-white/30 hover:bg-white/50 text-slate-700" title="Toggle Fullscreen">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
            </svg>
        </button>
        <!-- Setup Section -->
        <div id="setup-section" class="card p-8 mb-8">
            <h1 class="text-6xl font-lilita text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-violet-500 tracking-wider">Metric Match-up</h1>
            <h2 class="text-xl mt-2 mb-6 text-slate-500">Team Showdown!</h2>
            <h3 class="text-lg font-semibold mb-4">How many teams are playing?</h3>
            <div id="team-count-selector" class="flex justify-center space-x-4 mb-6">
                <button data-count="2" class="btn bg-slate-200 hover:bg-slate-300 text-slate-700 w-16 h-16 text-3xl rounded-full">2</button>
                <button data-count="3" class="btn bg-slate-200 hover:bg-slate-300 text-slate-700 w-16 h-16 text-3xl rounded-full">3</button>
                <button data-count="4" class="btn bg-slate-200 hover:bg-slate-300 text-slate-700 w-16 h-16 text-3xl rounded-full">4</button>
            </div>
            <div id="team-config-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"></div>
            <button id="start-game-btn" class="btn btn-primary text-xl hidden w-full md:w-auto">Start Game</button>
        </div>

        <!-- Game Section -->
        <div id="game-section" class="hidden">
            <div class="flex justify-between items-center mb-4 px-2">
                 <h1 class="text-5xl font-lilita text-white tracking-wider" id="question-title">Which is MORE?</h1>
                <div>
                    <button id="reveal-btn" class="btn btn-yellow text-lg">Reveal Answer</button>
                    <button id="next-btn" class="btn btn-green text-lg hidden">Next Question</button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div id="choice-left" class="card choice-card">
                    <div class="flex-grow flex flex-col items-center justify-center">
                        <span class="text-8xl" id="emoji-left"></span>
                        <p class="text-2xl mt-4" id="desc-left"></p>
                        <p class="text-5xl font-lilita text-violet-600 mt-2" id="value-left"></p>
                    </div>
                    <div class="w-full min-h-[40px] mt-2 flex justify-center items-center flex-wrap gap-2"></div>
                </div>
                <div id="choice-right" class="card choice-card">
                     <div class="flex-grow flex flex-col items-center justify-center">
                        <span class="text-8xl" id="emoji-right"></span>
                        <p class="text-2xl mt-4" id="desc-right"></p>
                        <p class="text-5xl font-lilita text-violet-600 mt-2" id="value-right"></p>
                    </div>
                    <div class="w-full min-h-[40px] mt-2 flex justify-center items-center flex-wrap gap-2"></div>
                </div>
            </div>

            <div id="teams-control-area" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Team controls are generated here -->
            </div>
            <p id="feedback-text" class="text-2xl font-bold mt-4 h-8 text-white"></p>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const setupSection = document.getElementById('setup-section');
        const teamCountSelector = document.getElementById('team-count-selector');
        const teamConfigContainer = document.getElementById('team-config-container');
        const startGameBtn = document.getElementById('start-game-btn');
        const gameSection = document.getElementById('game-section');
        const choiceLeft = document.getElementById('choice-left');
        const choiceRight = document.getElementById('choice-right');
        const teamsControlArea = document.getElementById('teams-control-area');
        const emojiLeft = document.getElementById('emoji-left');
        const emojiRight = document.getElementById('emoji-right');
        const descLeft = document.getElementById('desc-left');
        const descRight = document.getElementById('desc-right');
        const valueLeft = document.getElementById('value-left');
        const valueRight = document.getElementById('value-right');
        const feedbackText = document.getElementById('feedback-text');
        const revealBtn = document.getElementById('reveal-btn');
        const nextBtn = document.getElementById('next-btn');
        const fullscreenBtn = document.getElementById('fullscreen-btn');

        // --- Game State ---
        let teams = [];
        let isAnswered = false;
        const unitPrefixes = {
            g: [ // Weight
                { symbol: 'kg', factor: 1000 },
                { symbol: 'g', factor: 1 },
                { symbol: 'mg', factor: 0.001 }
            ],
            m: [ // Length
                { symbol: 'km', factor: 1000 },
                { symbol: 'm', factor: 1 },
                { symbol: 'cm', factor: 0.01 },
                { symbol: 'mm', factor: 0.001 }
            ],
            L: [ // Volume
                { symbol: 'L', factor: 1 },
                { symbol: 'mL', factor: 0.001 }
            ]
        };
        const items = {
            g: [ { name: 'A bowling ball', emoji: '🎳' }, { name: 'An apple', emoji: '🍎' }, { name: 'A large car', emoji: '🚗' }, { name: 'A feather', emoji: '🪶' }, { name: 'A house cat', emoji: '🐈' } ],
            m: [ { name: 'A giant redwood', emoji: '🌲' }, { name: 'A pencil', emoji: '✏️' }, { name: 'A blue whale', emoji: '🐋' }, { name: 'A doorway', emoji: '🚪' }, { name: 'An ant', emoji: '🐜' } ],
            L: [ { name: 'A fish tank', emoji: '🐠' }, { name: 'A carton of milk', emoji: '🥛' }, { name: 'A swimming pool', emoji: '🏊' }, { name: 'A can of soda', emoji: '🥤' }, { name: 'A teaspoon', emoji: '🥄' } ]
        };
        let leftItem = {};
        let rightItem = {};
        let draggedItem = null;

        // --- Setup Logic ---
        const defaultColors = ['#f97316', '#10b981', '#ec4899', '#3b82f6'];

        teamCountSelector.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                const count = parseInt(e.target.dataset.count);
                createTeamConfigs(count);
                document.querySelectorAll('#team-count-selector button').forEach(btn => {
                    btn.classList.remove('bg-violet-500', 'text-white');
                    btn.classList.add('bg-slate-200', 'text-slate-700');
                });
                e.target.classList.add('bg-violet-500', 'text-white');
                e.target.classList.remove('bg-slate-200', 'text-slate-700');
            }
        });

        function createTeamConfigs(count) {
            teamConfigContainer.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const teamConfig = document.createElement('div');
                teamConfig.className = 'flex flex-col items-center space-y-2 p-3 bg-white/20 rounded-lg';
                teamConfig.innerHTML = `
                    <label for="team-name-${i}" class="font-semibold text-white">Team ${i + 1}</label>
                    <input type="text" id="team-name-${i}" class="w-full bg-white/50 border border-slate-300 rounded-md p-2 text-slate-700 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="Name" value="Team ${i+1}">
                    <input type="color" id="team-color-${i}" value="${defaultColors[i]}" class="w-full h-10 rounded-md cursor-pointer bg-transparent border-0">
                `;
                teamConfigContainer.appendChild(teamConfig);
            }
            startGameBtn.classList.remove('hidden');
        }

        startGameBtn.addEventListener('click', () => {
            teams = [];
            const configs = teamConfigContainer.querySelectorAll('div');
            configs.forEach((config, i) => {
                const name = config.querySelector(`#team-name-${i}`).value || `Team ${i+1}`;
                const color = config.querySelector(`#team-color-${i}`).value;
                teams.push({ id: i, name, color, score: 0, choice: null, choiceTimestamp: null });
            });
            setupSection.classList.add('hidden');
            gameSection.classList.remove('hidden');
            initializeGame();
        });

        // --- Game Logic ---
        function initializeGame() {
            createTeamControls();
            loadNextQuestion();
            addDragDropListeners();
        }

        function formatBaseValue(value, baseUnit) {
            const formatPrefixes = [
                { symbol: 'G', factor: 1e9 },
                { symbol: 'M', factor: 1e6 },
                { symbol: 'k', factor: 1e3 },
                { symbol: '', factor: 1 },
                { symbol: 'm', factor: 1e-3 },
                { symbol: 'μ', factor: 1e-6 },
            ];

            if (value === 0) return `0 ${baseUnit}`;

            for (const p of formatPrefixes) {
                if (Math.abs(value) >= p.factor) {
                    const displayVal = value / p.factor;
                    const formattedVal = parseFloat(displayVal.toPrecision(3));
                    return `${formattedVal.toLocaleString()} ${p.symbol}${baseUnit}`;
                }
            }
            
            const smallestPrefix = formatPrefixes[formatPrefixes.length - 1];
            const displayVal = value / smallestPrefix.factor;
            const formattedVal = parseFloat(displayVal.toPrecision(3));
            return `${formattedVal.toLocaleString()} ${smallestPrefix.symbol}${baseUnit}`;
        }

        function createTeamControls() {
            teamsControlArea.innerHTML = '';
            teams.forEach(team => {
                const teamControl = document.createElement('div');
                teamControl.id = `team-control-${team.id}`;
                teamControl.className = 'card p-4 flex flex-col items-center justify-between space-y-3';
                teamControl.innerHTML = `
                    <div id="token-start-zone-${team.id}" class="token-start-zone">
                         <div id="team-token-${team.id}" class="team-token-disc" draggable="true" style="background-color: ${team.color};"></div>
                    </div>
                    <div class="text-center">
                        <p class="text-lg font-semibold" style="color: ${team.color}; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);">${team.name}</p>
                        <p id="team-score-${team.id}" class="text-4xl font-lilita text-slate-600">${team.score}</p>
                    </div>
                `;
                teamsControlArea.appendChild(teamControl);
            });
        }

        function generateQuestion() {
            const category = Object.keys(items)[Math.floor(Math.random() * Object.keys(items).length)];
            const baseUnit = category;
            const availablePrefixes = unitPrefixes[baseUnit];
            
            let item1Index, item2Index;
            do { item1Index = Math.floor(Math.random() * items[category].length); } while (!items[category][item1Index]);
            do { item2Index = Math.floor(Math.random() * items[category].length); } while (item1Index === item2Index || !items[category][item2Index]);
            
            const item1 = items[category][item1Index];
            const item2 = items[category][item2Index];

            let prefix1Index, prefix2Index;
            do { prefix1Index = Math.floor(Math.random() * availablePrefixes.length); } while (!availablePrefixes[prefix1Index]);
            do { prefix2Index = Math.floor(Math.random() * availablePrefixes.length); } while (prefix1Index === prefix2Index || !availablePrefixes[prefix2Index]);

            const prefix1 = availablePrefixes[prefix1Index];
            const prefix2 = availablePrefixes[prefix2Index];
            
            const baseValue1 = (Math.random() * 20 + 1) * Math.pow(10, Math.floor(Math.random() * 2));
            const baseValue2 = baseValue1 * (Math.random() * 1.5 + 1.5);

            let val1 = baseValue1, val2 = baseValue2;
            if (Math.random() > 0.5) [val1, val2] = [val2, val1];
            
            leftItem = { ...item1, value: val1, prefix: prefix1, baseUnit };
            rightItem = { ...item2, value: val2, prefix: prefix2, baseUnit };
            
            leftItem.displayValue = parseFloat((leftItem.value / leftItem.prefix.factor).toPrecision(3));
            rightItem.displayValue = parseFloat((rightItem.value / rightItem.prefix.factor).toPrecision(3));
        }

        function loadNextQuestion() {
            isAnswered = false;
            feedbackText.textContent = '';
            feedbackText.classList.remove('text-yellow-300', 'text-red-400');
            nextBtn.classList.add('hidden');
            revealBtn.classList.remove('hidden');
            revealBtn.disabled = false;
            
            teams.forEach(t => { t.choice = null; t.choiceTimestamp = null; });
            [choiceLeft, choiceRight].forEach(c => c.classList.remove('correct', 'incorrect'));
            
            generateQuestion();

            valueLeft.innerHTML = `${leftItem.displayValue.toLocaleString()} ${leftItem.prefix.symbol}`;
            valueRight.innerHTML = `${rightItem.displayValue.toLocaleString()} ${rightItem.prefix.symbol}`;
            emojiLeft.textContent = leftItem.emoji;
            descLeft.textContent = leftItem.name;
            emojiRight.textContent = rightItem.emoji;
            descRight.textContent = rightItem.name;
            
            teams.forEach(team => {
                const token = document.getElementById(`team-token-${team.id}`);
                const startZone = document.getElementById(`token-start-zone-${team.id}`);
                if (token && startZone) {
                    token.classList.remove('placed');
                    startZone.appendChild(token);
                    token.draggable = true;
                }
            });
        }
        
        function checkAnswers() {
            if (isAnswered) return;
            isAnswered = true;
            revealBtn.disabled = true;

            document.querySelectorAll('.team-token-disc').forEach(t => t.draggable = false);

            const leftTotalValue = leftItem.value;
            const rightTotalValue = rightItem.value;
            let correctAnswer = leftTotalValue > rightTotalValue ? 'left' : 'right';
            if (leftTotalValue === rightTotalValue) correctAnswer = 'neither';
            
            const correctTeams = teams.filter(team => team.choice === correctAnswer || (correctAnswer === 'neither' && team.choice !== null));
            let firstCorrectTeam = null;

            if (correctTeams.length > 0) {
                correctTeams.sort((a, b) => a.choiceTimestamp - b.choiceTimestamp);
                firstCorrectTeam = correctTeams[0];
                
                correctTeams.forEach(team => team.score++);
                
                if (firstCorrectTeam) {
                    firstCorrectTeam.score++; // Bonus point
                    feedbackText.textContent = `${firstCorrectTeam.name} was first and correct! +2 points!`;
                    feedbackText.classList.add('text-yellow-300');
                }
            } else {
                 feedbackText.textContent = "Nobody got it right!";
                 feedbackText.classList.add('text-red-400');
            }
            
            if (correctAnswer === 'left' || correctAnswer === 'neither') choiceLeft.classList.add('correct'); else choiceLeft.classList.add('incorrect');
            if (correctAnswer === 'right' || correctAnswer === 'neither') choiceRight.classList.add('correct'); else choiceRight.classList.add('incorrect');
            
            valueLeft.innerHTML += `<br><span class="text-base font-sans text-slate-600">(${formatBaseValue(leftTotalValue, leftItem.baseUnit)})</span>`;
            valueRight.innerHTML += `<br><span class="text-base font-sans text-slate-600">(${formatBaseValue(rightTotalValue, rightItem.baseUnit)})</span>`;

            updateScores();
            nextBtn.classList.remove('hidden');
            revealBtn.classList.add('hidden');
        }

        function updateScores() {
            teams.forEach(team => {
                document.getElementById(`team-score-${team.id}`).textContent = team.score;
            });
        }
        
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function addDragDropListeners() {
            document.body.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('team-token-disc')) {
                    draggedItem = e.target;
                    setTimeout(() => { e.target.style.opacity = '0.5'; }, 0);
                }
            });
            document.body.addEventListener('dragend', (e) => {
                if (draggedItem) {
                    draggedItem.style.opacity = '1';
                    draggedItem = null;
                }
            });

            const dropZones = [choiceLeft, choiceRight, ...document.querySelectorAll('.token-start-zone')];
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', e => { e.preventDefault(); });
                zone.addEventListener('dragenter', e => {
                    e.preventDefault();
                    if(e.currentTarget.classList.contains('card')) e.currentTarget.classList.add('drop-zone-active');
                });
                zone.addEventListener('dragleave', e => {
                     if(e.currentTarget.classList.contains('card')) e.currentTarget.classList.remove('drop-zone-active');
                });
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    const dropTarget = e.currentTarget;
                    if (!draggedItem) return;

                    if(dropTarget.classList.contains('card')) dropTarget.classList.remove('drop-zone-active');
                    if (dropTarget.classList.contains('team-token-disc')) return;
                    
                    if (dropTarget.classList.contains('choice-card') || dropTarget.classList.contains('token-start-zone')) {
                        if (dropTarget.classList.contains('token-start-zone') && dropTarget.children.length > 0) return;
                        
                        const tokenDropArea = dropTarget.classList.contains('choice-card') ? dropTarget.querySelector('.w-full') : dropTarget;
                        tokenDropArea.appendChild(draggedItem);
                        
                        const teamId = parseInt(draggedItem.id.split('-')[2]);
                        const team = teams.find(t => t.id === teamId);

                        if (team.choiceTimestamp === null) team.choiceTimestamp = Date.now();
                        
                        if (dropTarget.id === 'choice-left') {
                            team.choice = 'left';
                            draggedItem.classList.add('placed');
                        } else if (dropTarget.id === 'choice-right') {
                            team.choice = 'right';
                            draggedItem.classList.add('placed');
                        } else { 
                            team.choice = null; 
                            team.choiceTimestamp = null; 
                            draggedItem.classList.remove('placed');
                        }
                    }
                });
            });
        }

        // --- Event Listeners ---
        revealBtn.addEventListener('click', checkAnswers);
        nextBtn.addEventListener('click', loadNextQuestion);
        fullscreenBtn.addEventListener('click', toggleFullScreen);
    </script>
</body>
</html>

